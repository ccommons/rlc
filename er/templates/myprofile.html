{% extends "modal.html" %}
{% block modal_title %}
    <div class="modal-title">
        <div class="profile-header">
            <span class="profile-name">{{ user.first_name }} {{user.last_name }}</span>
            {% if profile.title %}<span class="profile-title">{{ profile.title }}</span>{% endif %}
            {% if profile.department %}<span class="profile-dept">{{ profile.department }}</span>{% endif %}
            {% if profile.institution %}<span class="profile-institution">{{ profile.institution }}</span>{% endif %}
            {% if not form_action %}
                {% if user.email %}<span class="profile-mailto"><a href="mailto:{{user.email}}">{{ user.email }}</a></span>{% endif %}
            {% endif %}
        </div>
    </div>
{% endblock %}
{% block modal_summary %}
    <div class="profile-summary">
        <ul class="inline">
        {% if num_note > 0 %}
        <li class="profile-summary-item"><h2 class="profile-summary-counter text-blue1"><em>{{ num_note }}</em></h2><strong>Note{{ num_note|pluralize }}</strong></li>
        {% endif %}
        {% if num_proprev > 0 %}
        <li class="profile-summary-item"><h2 class="profile-summary-counter text-red1"><em>{{ num_proprev }}</em></h2><strong>Proposed Revision{{ num_proprev|pluralize }}</strong></li>
        {% endif %}
        {% if num_openq > 0 %}
        <li class="profile-summary-item"><h2 class="profile-summary-counter text-blue2"><em>{{ num_openq }}</em></h2><strong>Open Question{{ num_openq|pluralize }}</strong></li>
        {% endif %}
        {% if num_comment > 0 %}
        <li class="profile-summary-item"><h2 class="profile-summary-counter"><em>{{ num_comment }}</em></h2><strong>Comment{{ num_comment|pluralize }}</strong></li>
        {% endif %}
        </ul>
    </div>
{% endblock %}
{% block modal_body %}
    <ul id="dummytab" class="nav nav-tabs"{% if not form_action %} style="display:none"{% endif %}>
    {% if form_action %}<li class="active"><a id="profile-tab-details" href="#profile-details">Details</a></li>{% endif %}
    <li><a id="profile-tab-conversations" href="#profile-conversations">Conversations</a></li>
    </ul>
    <script language="javascript">
    $('#dummytab a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
    })
    </script>
    <div id="myTabContent" class="tab-content">
        {% if form_action %}
        <div class="tab-pane fade active in" id="profile-details">
        <form id="profile-update-form">
        <div>
        {{ profile_form.as_p }}
        {% csrf_token %}
        </div>
        <div class="right">
            <p><label>Email Alerts</label></p>
            <ul class="email-preference-group">
                <li>{{ email_form.all_notifications }} All notifications</li>
            </ul>
            <ul class="email-preference-group">
                <li>{{ email_form.activity_all }} When there's activity on one of my:</li>
                <li>{{ email_form.activity_note }} Notes</li>
                <li>{{ email_form.activity_rev }} Revisions</li>
                <li>{{ email_form.activity_openq }} Open Questions</li>
                <li>{{ email_form.activity_comment }} Comments</li></li></li></li>
            </ul>
            <ul class="email-preference-group">
                <li>{{ email_form.er_all }} When there's activity on one of my:</li>
                <li>{{ email_form.er_revised }} Revised</li>
                <li>{{ email_form.er_updated }} Updated</li>
                <li>{{ email_form.er_published }} Published</li>
            </ul>
            <ul class="email-preference-group">
                <li>{{ email_form.new_members }} New members</li>
            </ul>
        </div>
        <div id="profile-update-form-buttons">
            <button type="button" id="profile-update-submit" action="{{ form_action }}" class="btn">Submit</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
        </form>
        </div>
        {% endif %}
        <div class="tab-pane {% if not form_action %}active in{% endif %} fade" id="profile-conversations">
            <ul>
            {% for item in items %}
                <li class="profile-conv-item" id="profile-conv-{{ item.id }}">
                    <p class="profile-conv-line1">{{ item.ctype|upper }} | {{ item.age|upper }}</p>
                    <p class="profile-conv-context">
                    {% if item.item_id %}
                        <a href="javascript:news_comment_init('{{ item.url }}');">
                    {% else %}
                        <a href="javascript:annotation_init('{{ item.url }}');">
                    {% endif %}
                    {{ item.context|safe }}
                    </a></p>
                    <p class="profile-conv-line3">
                        {% include "rating_control.html" with comment=item.comment %}
                        {% if item.comments %}| {{ item.comments }} Comment{{ item.comments|pluralize }} {% endif %}
                    </p>
                </li>
            {% empty %}
                <li class="profile-conv-empty">No {% if form_action %}conversations{% else %}contributions{% endif %}</li>
            {% endfor %}
            </ul>
        </div>
    </div>{# tabbed content #}
{% endblock %}
